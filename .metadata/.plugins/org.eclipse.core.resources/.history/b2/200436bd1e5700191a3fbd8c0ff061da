
<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
pageEncoding="ISO-8859-1" import="com.cs336.pkg.*"%>
<%@ page import="java.io.*,java.util.*,java.sql.*"%>
<%@ page import="javax.servlet.http.*,javax.servlet.*"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>ConfirmBid</title>
</head>
<body>
<%
int jewelryID = Integer.parseInt(request.getParameter("id"));
String email = ""+session.getAttribute("username");
int bidParam = Integer.parseInt(request.getParameter("bidAmount"));
try{
ApplicationDB db = new ApplicationDB();	
Connection con = db.getConnection();
Statement stmt = con.createStatement();
String str="INSERT INTO Bid (duration, cost, jewelryID, email) values (?, ?, ?, ?);";
PreparedStatement ps = con.prepareStatement(str);
Timestamp duration = new Timestamp(System.currentTimeMillis());
ps.setTimestamp(1,duration);
ps.setInt(2,bidParam);
ps.setInt(3,jewelryID);
ps.setString(4,email);
ps.executeUpdate();
con.close();
} catch (SQLException ex) {
out.println(ex);
if(ex.getSQLState().equals("45000")){
try{
//out.println("hello");
ApplicationDB db = new ApplicationDB();	
Connection con = db.getConnection();
Statement stmt = con.createStatement();
String str="delete from Bid where jewelryID="+jewelryID+" and cost="+bidParam;
stmt.execute(str);
con.close();
} catch (Exception x){
out.println(x);					
}
} 
else if (ex.getSQLState().equals("40000")){
	out.println("<p>Your bid must be at least whatever the seller's increment number was plus the current proce of the item!</p>");
	/* ApplicationDB db = new ApplicationDB();	
	Connection con = db.getConnection();
	Statement stmt = con.createStatement();
	String str="delete from Bid where jewelryID="+jewelryID+" and cost="+bidParam;
	stmt.execute(str);
	con.close(); */
}
}		
%>
<p><a href='jewelryPage.jsp?id=<%=jewelryID%>'>Click to go back to jewelry page</a></p>
<a href='dash.jsp'>Click to go back to dashboard</a>
</body>
</html>